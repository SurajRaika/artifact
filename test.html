




<!DOCTYPE html>
<html lang="en">
<head>

    

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AUCTION.BW-Live Auctions</title>
<link rel="stylesheet" href="/style/style.css">
<script src="https://unpkg.com/lucide@latest"></script>

<style>
    /* All original CSS styles are kept here for brevity, 
           as moving them to an external CSS file was not requested.
           (Imports, brutalist styles, nav animations, etc.) */
    @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=Teko:wght@500;600;700&display=swap');

    body {
        font-family: 'Outfit', sans-serif;
        background-color: #f0f0f0;
        color: #000;
    }

    .logotype {
        font-family: 'Teko', sans-serif;
        line-height: 1;
    }

    ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
    }

    ::-webkit-scrollbar-track {
        background: #fff;
        border-left: 2px solid #000;
    }

    ::-webkit-scrollbar-thumb {
        background: #000;
    }

    ::-webkit-scrollbar-thumb:hover {
        background: #333;
    }

    .brutalist-border {
        border: 2px solid #000;
    }

    .brutalist-border-b {
        border-bottom: 2px solid #000;
    }

    .brutalist-border-t {
        border-top: 2px solid #000;
    }

    .brutalist-shadow {
        box-shadow: 4px 4px 0px #000;
    }

    .brutalist-shadow-sm {
        box-shadow: 2px 2px 0px #000;
    }

    .brutalist-shadow-hover:hover {
        transform: translate(-2px, -2px);
        box-shadow: 6px 6px 0px #000;
    }

    .brutalist-active:active {
        transform: translate(2px, 2px);
        box-shadow: 0px 0px 0px #000;
    }

    .nav-button {
        position: relative;
        transition: opacity 0.3s ease;
    }

    .nav-button.active {
        text-decoration: none;
        opacity: 1 !important;
    }

    .nav-button.active::after {
        content: "";
        position: absolute;
        left: 50%;
        bottom: -2px;
        width: 0;
        height: 2px;
        background: currentColor;
        transform: translateX(-50%);
        animation: underlineFade 0.6s ease forwards;
    }

    .nav-button.active {
        animation: softGlow 1.5s ease-in-out infinite alternate;
    }

    @keyframes underlineFade {
        from {
            width: 0;
            opacity: 0;
        }

        to {
            width: 70%;
            opacity: 1;
        }
    }

    @keyframes softGlow {
        from {
            text-shadow: 0 0 0 rgba(0, 0, 0, 0);
        }

        to {
            text-shadow: 0 0 6px rgba(0, 0, 0, 0.25);
        }
    }

    @keyframes slideIn {
        from {
            transform: translateX(100%);
            opacity: 0;
        }

        to {
            transform: translateX(0);
            opacity: 1;
        }
    }

    .toast-enter {
        transform: translateY(100%);
        animation: slideIn 0.3s ease-out forwards;
    }

    @keyframes fundsDeductionPulse {
        0% {
            background-color: #f0f0f0;
            transform: scale(1);
            box-shadow: 0 0 0 #000;
        }

        50% {
            background-color: #ffcccc;
            transform: scale(1.05);
            box-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
        }

        100% {
            background-color: #f0f0f0;
            transform: scale(1);
            box-shadow: 0 0 0 #000;
        }
    }

    .funds-deduction-pulse {
        animation: fundsDeductionPulse 0.5s ease-in-out;
    }

    .drag-over {
        border-color: #ff00ff !important;
        background-color: #ffeeff !important;
    }

    .selected-artifact {
        background-color: #000 !important;
        color: #fff !important;
        border-color: #000 !important;
    }

    .hc-shadow {
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
    }

    .status-winning {
        background-color: #ccffcc;
        color: #006600;
    }

    .status-outbid {
        background-color: #ffcccc;
        color: #cc0000;
    }

    .status-watching {
        background-color: #ccddff;
        color: #0000cc;
    }
</style>    <script>
        window.onload = function() {
            updateFundsDisplay(); // Set initial funds display
            // On load, apply the 'active' class to the correct button based on the current file
            const currentPageFile = window.location.pathname.split('/').pop();
            let activeView = ''; // Default

            if (currentPageFile === '' || currentPageFile === 'index.php' ) activeView = 'live-auctions';
            else if (currentPageFile === 'private-lots.php') activeView = 'private-lots';
            else if (currentPageFile === 'sell-artifact.php') activeView = 'sell-artifact';
            else if (currentPageFile === 'bids.php') activeView = 'my-bids';
            else if (currentPageFile === 'my-search.php') activeView = 'search';

            document.querySelectorAll('.nav-button').forEach(btn => {
                const buttonViewId = btn.getAttribute('data-view');
                if (buttonViewId === activeView) {
                    btn.classList.add('active');
                    btn.classList.remove('opacity-50');
                } else {
                    btn.classList.remove('active');
                    btn.classList.add('opacity-50');
                }
            });
            currentView = activeView;
            lucide.createIcons();

            // Call specific initializers for the current page (assuming they are defined in index.php, etc.)
            if (typeof initIndexPage === 'function') initIndexPage();
            if (typeof initPrivateLots === 'function') initPrivateLots();
            if (typeof initSellArtifact === 'function') initSellArtifact();
            if (typeof initMyBids === 'function') initMyBids();
        }
    </script>
</head>

<body class="h-screen flex flex-col overflow-hidden">

    <header class="flex flex-col items-center justify-between z-20 w-full brutalist-border-b">
    <div class="h-16 bg-white flex items-center justify-between px-4 z-20 shrink-0 w-full border-b-2 border-black ">
        <div class="flex items-center gap-4">
            <div class="font-bold text-2xl tracking-tight flex items-center gap-1.5">
                <span class="logotype text-4xl font-semibold sm:inline">AUCTION</span>
                <div class="bg-black text-white px-2 py-0.5 text-sm font-semibold tracking-widest ">
                    .COM
                </div>
            </div>
        </div>

        <nav id="main-nav-desktop" class="hidden md:flex gap-6 font-medium text-sm uppercase tracking-wide">
            <button data-view="live-auctions" onclick="changeView('live-auctions')"
                class="nav-button hover:underline decoration-2 underline-offset-4 opacity-50 ">Live Auctions</button>
            <button data-view="private-lots" onclick="changeView('private-lots')"
                class="nav-button hover:underline decoration-2 underline-offset-4 opacity-50">Private Lots</button>
            <button data-view="sell-artifact" onclick="changeView('sell-artifact')"
                class="nav-button hover:underline decoration-2 underline-offset-4 opacity-50">Sell Artifact</button>
            <button data-view="my-bids" onclick="changeView('my-bids')"
                class="nav-button hover:underline underline-offset-4 decoration-2 opacity-50">My Bids</button>
            <button data-view="search" onclick="changeView('my-search')"
                class="nav-button hover:underline decoration-2 underline-offset-4 opacity-50">Search</button>
        </nav>

        <div class="flex items-center gap-3 relative">

            <div id="profile-modal"
                class="absolute top-full right-0 mt-2 brutalist-border brutalist-shadow bg-white z-50 w-72 hidden">
                <div class="flex items-center p-4 border-b-2 border-black">
                    <div
                        class="bg-black text-white w-10 h-10 rounded-full flex items-center justify-center font-mono font-bold text-lg mr-3">
                        D9
                    </div>
                    <div>
                        <div class="font-bold uppercase text-sm">User:D9F3</div>
                        <div class="text-xs text-gray-600 font-mono">Status: Active Bidder</div>
                    </div>
                </div>

                <div class="p-4">
                    <h4 class="font-bold uppercase text-xs mb-2 border-b border-gray-200 pb-1">Recent Transactions
                    </h4>
                    <ul id="transaction-list" class="space-y-2 text-xs font-mono">
                    </ul>
                    <button
                        class="w-full mt-4 bg-black text-white py-2 text-xs font-bold uppercase hover:bg-gray-800 brutalist-shadow-sm brutalist-active brutalist-border">
                        View Full History
                    </button>
                </div>
            </div>

            <div id="funds-display" onclick="toggleProfileModal()" title="View Profile & Transactions"
                class="text-right cursor-pointer p-2 rounded hover:bg-gray-100 transition-colors sm:block sm:w-36">
                <div class="text-[10px] uppercase font-bold text-gray-500">Available Funds</div>
                <div class="font-bold font-mono text-sm sm:text-base transition-opacity opacity-0">$0</div>
            </div>

        </div>
    </div>

    <nav id="mobile-nav"
        class=" md:hidden w-full bg-white flex justify-center text-sm uppercase tracking-wide font-medium">
        <button data-view="live-auctions" onclick="changeView('live-auctions'); "
            class="nav-button p-3 border-b border-gray-100 hover:bg-gray-50 text-left ">Live Auctions</button>
        <button data-view="private-lots" onclick="changeView('private-lots');"
            class="nav-button p-3 border-b border-gray-100 hover:bg-gray-50 text-left opacity-50">Private
            Lots</button>
        <button data-view="sell-artifact" onclick="changeView('sell-artifact');"
            class="nav-button p-3 border-b border-gray-100 hover:bg-gray-50 text-left opacity-50">Sell
            Artifact</button>
        <button data-view="my-bids" onclick="changeView('my-bids'); "
            class="nav-button p-3 border-b border-gray-100 hover:bg-gray-50 text-left opacity-50">My Bids</button>
    </nav>
</header>
    <div class="flex flex-col md:flex-row flex-1 overflow-hidden">
        <div id="layout_main" class="flex flex-col md:flex-row flex-1 relative overflow-hidden">

            <main class="flex-1 bg-gray-50 overflow-y-auto relative">
                


<div id="live-auctions-view" class="view-content p-4 md:p-8 max-w-7xl mx-auto">












<div id="featured-lot" class="mb-8 brutalist-border bg-white brutalist-shadow p-4 sm:p-6 flex flex-col md:flex-row justify-between items-center gap-6">
                        <div class="md:w-1/3 w-full border-2 border-gray-200 bg-gray-100 p-4 text-center">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="image-off" class="lucide lucide-image-off w-10 h-10 mx-auto text-gray-400 mb-2"><line x1="2" x2="22" y1="2" y2="22"></line><path d="M10.41 10.41a2 2 0 1 1-2.83-2.83"></path><line x1="13.5" x2="6" y1="13.5" y2="21"></line><line x1="18" x2="21" y1="12" y2="15"></line><path d="M3.59 3.59A1.99 1.99 0 0 0 3 5v14a2 2 0 0 0 2 2h14c.55 0 1.052-.22 1.41-.59"></path><path d="M21 15V5a2 2 0 0 0-2-2H9"></path></svg>
                            <p class="font-mono text-xs text-gray-600">LOT 001 IMAGE PREVIEW</p>
                        </div>
                        <div class="md:w-2/3 w-full">
                            <span class="bg-black text-white px-2 py-0.5 text-xs font-bold uppercase mb-2 inline-block">Featured Lot</span>
                            <!-- Responsive Typography for Title -->
                            <h1 class="text-2xl sm:text-3xl md:text-4xl font-bold uppercase leading-tight tracking-tighter">The Lost Codex of Alexandria</h1>
                            <p class="font-mono mt-3 text-sm text-gray-600">A preserved 4th-century parchment containing early scientific sketches.</p>
                            <div class="flex items-center justify-between mt-4 border-t border-black pt-3">
                                <div class="text-xs uppercase font-bold text-gray-500">Current Bid</div>
                                <div class="font-bold text-xl sm:text-2xl font-mono text-black" id="featured-bid">$3,500,000</div>
                            </div>
                            <button onclick="selectArtifact(artifacts[0].id)" class="bg-black text-white px-8 py-3 font-bold uppercase w-full mt-4 hover:bg-white hover:text-black border-2 border-black transition-all brutalist-shadow-hover brutalist-active">
                                Place Bid Now
                            </button>
                        </div>
                    </div>

























    <h1 class="text-3xl font-bold uppercase tracking-tight brutalist-border-b pb-2 mb-4">Live Auctions</h1>

    <div class="flex flex-wrap gap-2 mb-6 text-sm font-medium uppercase">
        <button onclick="filterCategory('all')"
            class="filter-button px-3 py-1 brutalist-border brutalist-shadow-sm bg-black text-white hover:bg-gray-800 brutalist-active">All
            Categories</button>
        <button onclick="filterCategory('archaeology')"
            class="filter-button px-3 py-1 brutalist-border brutalist-shadow-sm bg-white hover:bg-gray-100 brutalist-active">Archaeology</button>
        <button onclick="filterCategory('fineart')"
            class="filter-button px-3 py-1 brutalist-border brutalist-shadow-sm bg-white hover:bg-gray-100 brutalist-active">Fine Art</button>
        <button onclick="filterCategory('historical')"
            class="filter-button px-3 py-1 brutalist-border brutalist-shadow-sm bg-white hover:bg-gray-100 brutalist-active">Historical</button>
        <button onclick="filterCategory('rarebooks')"
            class="filter-button px-3 py-1 brutalist-border brutalist-shadow-sm bg-white hover:bg-gray-100 brutalist-active">Rare Books</button>
    </div>

    <div id="artifacts-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
    </div>
</div>

<script>
    // Component-Specific State (Redefine artifacts for local use)
    const artifacts = [{"id":101,"lot":"LOT 101","category":"archaeology","title":"Roman Denarius Coin Set","description":"A collection of 12 silver coins from the reign of Emperor Hadrian.","currentBid":550000,"time":7200,"bids":[{"amount":550000,"user":"User:B82C","time":"5m ago"},{"amount":500000,"user":"User:F1A0","time":"12m ago"},{"amount":480000,"user":"User:B82C","time":"1h ago"}]},{"id":102,"lot":"LOT 102","category":"fineart","title":"Monochrome Sketch No. 4","description":"Original ink drawing by an early 20th-century Russian modernist.","currentBid":1200000,"time":14400,"bids":[{"amount":1200000,"user":"User:F1A0","time":"20m ago"},{"amount":1100000,"user":"User:C9D3","time":"1h 30m ago"}]},{"id":103,"lot":"LOT 103","category":"historical","title":"Original Apollo 11 Flight Plan","description":"A signed working copy of the ascent burn checklist.","currentBid":4500000,"time":3600,"bids":[{"amount":4500000,"user":"User:D77E","time":"1m ago"},{"amount":4200000,"user":"User:F1A0","time":"1m ago"}]},{"id":104,"lot":"LOT 104","category":"rarebooks","title":"First Edition \"Principia\"","description":"A 1687 first edition of Isaac Newton's seminal work.","currentBid":8800000,"time":86400,"bids":[{"amount":8800000,"user":"User:C9D3","time":"1d ago"}]}];

    function renderArtifacts(filter = 'all') {
        const container = document.getElementById('artifacts-container');
        if (!container) return;

        container.innerHTML = '';

        const filtered = filter === 'all' ? artifacts : artifacts.filter(a => a.category === filter);

        // Update filter button styles
        document.querySelectorAll('.filter-button').forEach(btn => {
            if (btn.textContent.trim().toLowerCase().includes(filter.replace('all', 'categories').toLowerCase())) {
                btn.classList.remove('bg-white', 'text-black');
                btn.classList.add('bg-black', 'text-white');
            } else {
                btn.classList.remove('bg-black', 'text-white');
                btn.classList.add('bg-white', 'text-black');
            }
        });


        filtered.forEach(artifact => {
            // Note: selectedArtifactId is a global variable from layouts/base.php
            const isSelected = artifact.id === selectedArtifactId;

            // Adjusted card to use relative padding and font sizing
            const cardHtml = `
            <div onclick="selectArtifact(${artifact.id})" 
                 class="bg-white brutalist-shadow-sm hover:translate-x-1 transition-transform duration-200 cursor-pointer p-4 brutalist-border ${isSelected ? 'selected-artifact' : ''}">
                
                <span class="text-xs font-mono uppercase ${isSelected ? 'text-white/70' : 'text-gray-500'}">${artifact.lot}</span>
                <h3 class="font-bold text-lg uppercase leading-tight mt-1 mb-3">${artifact.title}</h3>
                
                <div class="w-full h-32 border-2 border-dashed ${isSelected ? 'border-white/50' : 'border-gray-300'} bg-gray-100 mb-3 flex items-center justify-center">
                    <i data-lucide="image-off" class="w-6 h-6 ${isSelected ? 'text-white/50' : 'text-gray-400'}"></i>
                </div>
                
                <p class="text-xs ${isSelected ? 'text-white/80' : 'text-gray-600'} mb-3 truncate">${artifact.description}</p>
                
                <div class="flex justify-between items-center border-t ${isSelected ? 'border-white/20' : 'border-gray-200'} pt-2">
                    <div>
                        <div class="text-[10px] uppercase font-bold ${isSelected ? 'text-white/70' : 'text-gray-500'}">High Bid</div>
                        <div class="font-bold text-lg font-mono">${formatter.format(artifact.currentBid)}</div>
                    </div>
                    <div class="text-right">
                        <div class="text-[10px] uppercase font-bold ${isSelected ? 'text-white/70' : 'text-gray-500'}">Time Left</div>
                        <div class="font-bold font-lg text-red-600">${formatTime(artifact.time)}</div>
                    </div>
                </div>
            </div>
        `;
            container.insertAdjacentHTML('beforeend', cardHtml);
        });
        lucide.createIcons();
    }
    window.renderArtifacts = renderArtifacts;

    function filterCategory(category) {
        currentFilter = category;
        renderArtifacts(category);
    }

    // Initializer function called from layouts/base.php onload
    function initIndexPage() {
        renderArtifacts(currentFilter);
        renderTerminal(); // Render the terminal based on initial selectedArtifactId
    }
</script>
<script>
    function renderArtifacts(filter = 'all') {
        const container = document.getElementById('artifacts-container');
        // Only render if we are on the live-auctions view
        if (!container) return;

        container.innerHTML = '';

        const filtered = filter === 'all' ? artifacts : artifacts.filter(a => a.category === filter);

        filtered.forEach(artifact => {
            const isSelected = artifact.id === selectedArtifactId;

            // Adjusted card to use relative padding and font sizing
            const cardHtml = `
                    <div onclick="selectArtifact(${artifact.id})" 
                         class="bg-white brutalist-shadow-sm hover:translate-x-1 transition-transform duration-200 cursor-pointer p-4 brutalist-border ${isSelected ? 'selected-artifact' : ''}">
                        
                        <span class="text-xs font-mono uppercase ${isSelected ? 'text-white/70' : 'text-gray-500'}">${artifact.lot}</span>
                        <h3 class="font-bold text-lg uppercase leading-tight mt-1 mb-3">${artifact.title}</h3>
                        
                        <div class="w-full h-32 border-2 border-dashed ${isSelected ? 'border-white/50' : 'border-gray-300'} bg-gray-100 mb-3 flex items-center justify-center">
                            <i data-lucide="image-off" class="w-6 h-6 ${isSelected ? 'text-white/50' : 'text-gray-400'}"></i>
                        </div>
                        
                        <p class="text-xs ${isSelected ? 'text-white/80' : 'text-gray-600'} mb-3 truncate">${artifact.description}</p>
                        
                        <div class="flex justify-between items-center border-t ${isSelected ? 'border-white/20' : 'border-gray-200'} pt-2">
                            <div>
                                <div class="text-[10px] uppercase font-bold ${isSelected ? 'text-white/70' : 'text-gray-500'}">High Bid</div>
                                <div class="font-bold text-base font-mono">${formatter.format(artifact.currentBid)}</div>
                            </div>
                            <div class="text-right">
                                <div class="text-[10px] uppercase font-bold ${isSelected ? 'text-white/70' : 'text-gray-500'}">Time Left</div>
                                <div class="font-bold  text-base font-mono text-red-600">${formatTime(artifact.time)}</div>
                            </div>
                        </div>
                    </div>
                `;
            container.insertAdjacentHTML('beforeend', cardHtml);
        });
        lucide.createIcons();
    }

    function filterCategory(category) {
        currentFilter = category;
        renderArtifacts(category);
    }




</script>

            </main>

            
<aside id="bidding_terminal" onclick="expandTerminal()" 
    class="md:w-64 lg:w-96  w-full bg-white shadow-lg border-t-8 md:border-t-0 md:border-l-2 border-black overflow-y-auto shrink-0 z-20 md:z-10 flex flex-col absolute md:static  bottom-0 left-0 transition-all duration-300 ease-in-out h-[0%] md:h-full cursor-pointer">
    
    <div id="empty-terminal"
        class="flex flex-col items-center justify-center h-full p-8 text-center bg-gray-50">
        <i data-lucide="scan" class="w-12 h-12 text-gray-400 mb-4"></i>
        <h3 class="font-bold text-lg uppercase mb-2">Bidding Terminal</h3>
        <p class="text-sm text-gray-500 font-mono">Select an artifact from the list to view live details and
            place a bid.</p>
        <div class="mt-4 p-2 bg-white brutalist-border-b text-xs font-mono">
            Session ID: <span class="font-bold">2025-Q4-ALPHA-01</span>
        </div>
    </div>

    <div id="terminal-details" class="flex-1 p-4 md:p-6 flex flex-col justify-between hidden">
        <div class="space-y-4">
            <div class="flex justify-between items-start border-b-2 border-black pb-2">
                <div>
                    <span id="terminal-lot" class="text-sm font-mono uppercase text-gray-500">LOT XXX</span>
                    <h2 id="terminal-title" class="text-xl font-bold uppercase leading-tight">Artifact Title Here</h2>
                    <p id="terminal-category" class="text-xs font-mono text-gray-600 mt-1"></p>
                </div>
                
                <button onclick="event.stopPropagation(); clearSelection()" title="Close Terminal"
                    class="w-6 h-6 text-gray-500 hover:text-black z-30 relative md:hidden">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>

            <div class="w-full h-40 border-2 border-dashed border-gray-300 bg-gray-100 flex items-center justify-center mb-4">
                <i data-lucide="camera-off" class="w-8 h-8 text-gray-400"></i>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div class="p-3 brutalist-border bg-gray-50">
                    <div class="text-[10px] uppercase font-bold text-gray-500">Current High Bid</div>
                    <div id="terminal-current-bid" class="font-bold text-2xl font-mono text-black mt-1">$0</div>
                </div>
                <div class="p-3 brutalist-border bg-gray-50">
                    <div class="text-[10px] uppercase font-bold text-gray-500">Time Remaining</div>
                    <div id="terminal-time-left" class="font-bold text-2xl font-mono text-red-600 mt-1">00:00:00</div>
                </div>
            </div>

            <div>
                <h4 class="font-bold uppercase text-sm mt-4 mb-2 border-b border-gray-200 pb-1">Bidding History (3 Latest)</h4>
                <ul id="terminal-history" class="text-xs font-mono space-y-1">
                </ul>
            </div>
        </div>
    </div>

    <div id="bid-footer" onclick="event.stopPropagation()" class="p-4 md:p-6 brutalist-border-t bg-gray-100 shrink-0 hidden cursor-auto">
        <div class="flex items-center justify-between mb-3">
            <div class="text-xs uppercase font-bold text-gray-500">Minimum Next Bid</div>
            <div id="terminal-min-bid" class="font-bold text-lg font-mono text-black">$5,000</div>
        </div>

        <input type="number" id="bid-input" placeholder="Enter your bid"
            onkeydown="if(event.key === 'Enter') placeBid()"
            class="w-full px-3 py-2 border-2 border-black font-mono text-lg focus:outline-none focus:ring-2 focus:ring-black mb-3">
        <button onclick="placeBid()"
            class="w-full bg-red-600 text-white py-3 font-bold uppercase tracking-widest hover:bg-black hover:text-white transition-all brutalist-shadow brutalist-active border-2 border-black">
            Place Bid
        </button>
    </div>
</aside>

<script>
    console.log("Bidding terminal loaded");

    // NEW FUNCTION: Expands terminal when clicked, but only if it's in "peek" (40%) mode
    function expandTerminal() {
        const biddingTerminal = document.getElementById('bidding_terminal');
        
        // We check inline style. If it is exactly 40%, we expand it.
        if (biddingTerminal.style.height === "40%") {
            biddingTerminal.style.height = "100%";
        }
    }

    function renderTerminal() {
        const details = document.getElementById('terminal-details');
        const footer = document.getElementById('bid-footer');
        const emptyState = document.getElementById('empty-terminal');

        if (!selectedArtifactId) {
            details.classList.add('hidden');
            footer.classList.add('hidden');
            emptyState.classList.remove('hidden');
            const bidInput = document.getElementById('bid-input');
            if (bidInput) bidInput.value = '';
            
            const existingOverlay = document.getElementById('terminal-overlay');
            if (existingOverlay) existingOverlay.remove();
            return;
        }

        const artifact = artifacts.find(a => a.id === selectedArtifactId);
        if (!artifact) return;

        emptyState.classList.add('hidden');
        details.classList.remove('hidden');
        footer.classList.remove('hidden');

        // Populate main details
        document.getElementById('terminal-lot').textContent = artifact.lot;
        document.getElementById('terminal-title').textContent = artifact.title;
        document.getElementById('terminal-category').textContent = `Category: ${artifact.category.toUpperCase()}`;
        document.getElementById('terminal-current-bid').textContent = formatter.format(artifact.currentBid);
        document.getElementById('terminal-time-left').textContent = formatTime(artifact.time);

        const minNextBid = artifact.currentBid + 5000;
        document.getElementById('terminal-min-bid').textContent = formatter.format(minNextBid);

        const bidInput = document.getElementById('bid-input');
        bidInput.value = minNextBid;
        bidInput.min = minNextBid;

        const historyList = document.getElementById('terminal-history');
        historyList.innerHTML = '';
        artifact.bids.slice(0, 3).forEach(bid => { 
            const historyHtml = `
            <li class="flex justify-between">
                <span>${formatter.format(bid.amount)}</span>
                <span class="text-gray-400">${bid.user} (${bid.time})</span>
            </li>`;
            historyList.insertAdjacentHTML('beforeend', historyHtml);
        });

        lucide.createIcons();
    }

    selectArtifact = function(id) {
        const biddingTerminal = document.getElementById('bidding_terminal');
        const layoutMain = document.getElementById('layout_main');
        
        // If clicking the same item that is already open...
        if (id === selectedArtifactId) {
            // If it is currently minimized to 40%, expand it
            if (biddingTerminal.style.height === "40%") {
                biddingTerminal.style.height = "100%";
                return;
            }
            // If it is already 100%, we do nothing (or we could collapse, but UX usually prefers staying open)
            // If you want toggle behavior on the list click, uncomment below:
            /*
            else if (biddingTerminal.style.height === "100%") {
                 biddingTerminal.style.height = "40%";
                 return;
            }
            */
        }
        
        selectedArtifactId = id;

        // Reset to initial "Peek" state
          if (biddingTerminal.style.height === "0%") {
        biddingTerminal.style.height = "40%";
                return;
            }


        biddingTerminal.style.opacity = "1";

        // Create overlay
        if (layoutMain && layoutMain.classList.contains('relative')) {
            let overlay = document.getElementById('terminal-overlay');
            if (!overlay) {
                overlay = document.createElement('div');
                overlay.id = 'terminal-overlay';
                Object.assign(overlay.style, {
                    position: 'absolute',
                    top: '0',
                    left: '0',
                    width: '100%',
                    height: '100%',
                    backgroundColor: 'rgba(0, 0, 0, 0.5)', 
                    zIndex: '10', 
                    cursor: 'pointer'
                });
                overlay.addEventListener('click', (event) => {
                    event.stopPropagation();
                    clearSelection();
                });
                overlay.classList.add("md:hidden")
                layoutMain.appendChild(overlay);
            }
        }
        
        renderTerminal();
    }

    function clearSelection() {
        const biddingTerminal = document.getElementById('bidding_terminal');
        const existingOverlay = document.getElementById('terminal-overlay');

        biddingTerminal.style.height = "0%";
        biddingTerminal.style.opacity = "0";
        
        if (existingOverlay) {
            existingOverlay.remove();
        }

        selectedArtifactId = null;
        if (currentView === 'live-auctions' && typeof renderArtifacts === 'function') {
            renderArtifacts(currentFilter);
        }
        renderTerminal(); 
    }

    function placeBid() {
        if (!selectedArtifactId) return;

        const bidInput = document.getElementById('bid-input');
        const newBidAmount = parseFloat(bidInput.value);
        const artifact = artifacts.find(a => a.id === selectedArtifactId);
        const minBid = artifact.currentBid + 5000;

        if (isNaN(newBidAmount) || newBidAmount < minBid) {
            showToast(`Bid must be at least ${formatter.format(minBid)}!`, 'alert-triangle', 'red');
            return;
        }

        if (availableFunds < newBidAmount) {
            showToast(`Error: Insufficient funds!`, 'x-circle', 'red');
            return;
        }

        const btn = document.querySelector('#bid-footer button');
        const oldText = btn.innerText;
        btn.innerText = "VERIFYING BID...";
        btn.disabled = true;

        setTimeout(() => {
            availableFunds -= newBidAmount;
            transactions.unshift({
                id: Date.now(),
                type: 'BID PLACED',
                amount: -newBidAmount,
                date: new Date().toISOString().slice(0, 10),
                lot: artifact.id
            });

            const currentUserId = 'User:D9F3';
            artifact.currentBid = newBidAmount;
            artifact.bids.unshift({
                amount: newBidAmount,
                user: currentUserId,
                time: 'Just now',
            });

            showToast(`Bid Placed: ${formatter.format(newBidAmount)} on Lot ${artifact.lot}`, 'gavel', 'green');

            animateFundsDeduction();
            updateFundsDisplay();

            if (typeof renderArtifacts === 'function') {
                renderArtifacts(currentFilter);
            }
            renderTerminal();

            btn.innerText = oldText;
            btn.disabled = false;
        }, 1500);
    }

    function manageBid(id, status) {
        const artifact = artifacts.find(a => a.id === id);
        if (!artifact) return;
        window.event.stopPropagation();
        showToast(`Opening Proxy Manager for Lot ${artifact.lot || id}.`, 'settings-2', 'blue');
    }
</script>        </div>
    </div>

    <div id="toast-container" class="fixed top-4 right-4 z-50 flex flex-col gap-2 pointer-events-none"></div>

    <script>
    // PHP variables passed to JavaScript
    let availableFunds = 15450000;
    const accessFee = 5000;

    // NEW MOCK TRANSACTION DATA (Application-wide)
    let transactions = [{
            id: 1,
            type: 'BID PLACED',
            amount: -4500000,
            date: '2025-11-24',
            lot: 103
        },
        {
            id: 2,
            type: 'BID PLACED',
            amount: -1200000,
            date: '2025-11-23',
            lot: 102
        },
        {
            id: 3,
            type: 'DEPOSIT',
            amount: 10000000,
            date: '2025-11-20',
            lot: null
        },
        {
            id: 4,
            type: 'BID PLACED',
            amount: -550000,
            date: '2025-11-19',
            lot: 101
        },
        {
            id: 5,
            type: 'WITHDRAWAL',
            amount: -500000,
            date: '2025-11-18',
            lot: null
        },
    ];


    let selectedArtifactId = null;
    let currentFilter = 'all';
    let currentView = 'live-auctions'; // Tracks which view is currently active (initialized in base.php onload)
    let uploadedFiles = []; // Array to store mock file data
    let privateAccessGranted = false; // New state for private access


    // Helper to format currency
    const formatter = new Intl.NumberFormat('en-US', {
        style: 'currency',
        currency: 'USD',
        minimumFractionDigits: 0,
        maximumFractionDigits: 0,
    });

    // Helper to format time (seconds to HH:MM:SS)
    function formatTime(totalSeconds) {
        const hours = Math.floor(totalSeconds / 3600);
        const minutes = Math.floor((totalSeconds % 3600) / 60);
        const seconds = totalSeconds % 60;
        return [hours, minutes, seconds]
            .map(val => val.toString().padStart(2, '0'))
            .join(':');
    }

    // Function to update the Available Funds display in the header
    function updateFundsDisplay() {
        const fundsDisplay = document.querySelector('#funds-display div:last-child');
        if (fundsDisplay) {
            fundsDisplay.textContent = formatter.format(availableFunds);
            fundsDisplay.classList.remove('opacity-0')
        }
        // Update the fee warning text with the formatted fee (used in private-lots)
        const feeWarning = document.getElementById('fee-warning');
        if (feeWarning) {
            feeWarning.innerHTML = `WARNING: Each attempt to enter a secret code will incur a non-refundable **${formatter.format(accessFee)}** transaction fee. Please confirm the code before attempting.`;
        }
    }

    /**
     * Adds a temporary flash animation to the funds display element.
     */
    function animateFundsDeduction() {
        const fundsDisplay = document.getElementById('funds-display');
        if (fundsDisplay) {
            fundsDisplay.classList.add('funds-deduction-pulse');
            setTimeout(() => {
                fundsDisplay.classList.remove('funds-deduction-pulse');
            }, 500); // Animation duration is 0.5s
        }
    }


    function showToast(message, iconName, color) {
        const container = document.getElementById('toast-container');
        const el = document.createElement('div');
        el.className = `bg-black text-white px-6 py-4 border-2 border-white shadow-lg pointer-events-auto flex items-center gap-3 toast-enter min-w-[300px] border-${color}-400`;
        el.innerHTML = `
            <i data-lucide="${iconName}" class="w-5 h-5 text-${color}-400"></i>
            <div class="font-bold uppercase text-sm">${message}</div>
        `;
        container.appendChild(el);
        lucide.createIcons();

        setTimeout(() => {
            el.style.opacity = '0';
            el.style.transform = 'translateX(100%)';
            setTimeout(() => el.remove(), 500);
        }, 4000);
    }

    // --- Navigation Logic (Crucial for the layout to work) ---
    function changeView(viewId) {
        // Navigates to the corresponding PHP file.
        const pageMap = {
            'live-auctions': 'index.php',
            'private-lots': 'private-lots.php',
            'sell-artifact': 'sell-artifact.php',
            'my-bids': 'bids.php',
            'my-search': 'my-search.php',
        };

        const targetFile = pageMap[viewId];
        if (targetFile) {
            const currentPage = window.location.pathname.split('/').pop();
            // Allow client-side logic updates without full reload if already on page
            if (currentPage === targetFile) {
                currentView = viewId;
                // Add page-specific function calls here if needed (e.g., resetAppraisalForm())
                return;
            }

            // Navigate to the correct PHP file
            window.location.href = targetFile;
        } else {
            console.error(`Navigation target not found for view: ${viewId}`);
        }
    }

    // --- Profile Modal & Transactions (Header Component) ---
    function renderTransactions() {
        const list = document.getElementById('transaction-list');
        if (!list) return;

        list.innerHTML = '';

        transactions.slice(0, 4).forEach(tx => { // Show up to 4 recent transactions
            const isDebit = tx.amount < 0;
            const sign = isDebit ? '' : '+';
            const color = isDebit ? 'text-red-600' : 'text-green-600';
            const lotInfo = tx.lot ? ` (Lot ${tx.lot})` : '';
            const date = new Date(tx.date).toLocaleDateString('en-US', {
                month: 'short',
                day: 'numeric'
            });

            list.innerHTML += `
                <li class="flex justify-between items-center p-1 bg-gray-50 border border-gray-200">
                    <div class="truncate">
                        <span class="font-bold">${tx.type}</span><span class="text-gray-500 text-[10px]">${lotInfo}</span>
                    </div>
                    <span class="${color} font-bold">${sign}${formatter.format(tx.amount)}</span>
                </li>
            `;
        });
    }

    function toggleProfileModal() {
        const modal = document.getElementById('profile-modal');
        if (modal.classList.contains('hidden')) {
            renderTransactions();
            modal.classList.remove('hidden');
        } else {
            modal.classList.add('hidden');
        }
    }

    // Add a global click listener to close the modal when clicking outside
    document.addEventListener('click', (e) => {
        const modal = document.getElementById('profile-modal');
        const fundsDisplay = document.getElementById('funds-display');

        if (modal && fundsDisplay && !modal.classList.contains('hidden')) {
            const isClickInsideModal = modal.contains(e.target);
            const isClickOnFundsDisplay = fundsDisplay.contains(e.target);

            if (!isClickInsideModal && !isClickOnFundsDisplay) {
                modal.classList.add('hidden');
            }
        }
    });

</script>
</body>

</html>